{% extends 'base.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}

{% block body %}
    <div class="max-w-3xl mx-auto px-4 py-10 space-y-10">

        {# üìÑ Carte du post #}
        <div class="bg-white shadow-lg rounded-xl p-6">
            <h1 class="text-3xl font-bold mb-4">{{ post.title }}</h1>
            <p class="text-gray-800 mb-6 leading-relaxed">{{ post.content }}</p>

            <p class="text-sm text-gray-500">
                üïí Publi√© le {{ post.createdAt|date('d/m/Y √† H:i') }}
                {% if post.updatedAt > post.createdAt %}
                    ‚Äì Modifi√© le {{ post.updatedAt|date('d/m/Y √† H:i') }}
                {% endif %}
            </p>

            {% if app.user %}
                <form method="post" action="{{ path('app_post_like', { id: post.id }) }}">
                    <button type="submit"
                            class="inline-block px-4 py-2 bg-red-100 hover:bg-red-200 text-red-600 font-medium rounded-md transition">
                        {% set alreadyLiked = false %}
                        {% for like in post.likes %}
                            {% if like.user.id == app.user.id %}
                                {% set alreadyLiked = true %}
                            {% endif %}
                        {% endfor %}
                        {{ alreadyLiked ? 'üíî Je n‚Äôaime plus' : '‚ù§Ô∏è J‚Äôaime' }}
                    </button>
                </form>
            {% endif %}

            <p class="mt-6 text-sm text-gray-600">{{ post.getLikeCount() }} like(s)</p>
        </div>

        {# üí¨ Liste des commentaires #}
        <div>
            <h3 class="text-2xl font-semibold mb-4">Commentaires</h3>

            {% for comment in post.comments %}
                {% if app.user and app.user.userIdentifier == comment.author %}
                    <form method="post" action="{{ path('app_comment_delete', { id: comment.id }) }}"
                          onsubmit="return confirm('Voulez-vous vraiment supprimer ce commentaire ?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete_comment_' ~ comment.id) }}">
                        <button type="submit"
                                class="text-sm text-red-600 hover:underline mt-2">
                            Supprimer
                        </button>
                    </form>
                {% endif %}
                <div class="bg-white shadow-md rounded-xl p-4 mb-4">
                    <div class="flex justify-between items-center mb-1">
                        <span class="font-semibold text-gray-900">
                            {% if comment.author %}
                            {{ comment.author.pseudo }}
                            {% else %}
                                (Auteur inconnu)
                            {% endif %}
                        </span>
                        <span class="text-xs text-gray-500">{{ comment.createdAt|date('d/m/Y √† H:i') }}</span>
                    </div>
                    <p class="text-gray-700 mt-2">{{ comment.content }}</p>
                </div>
            {% else %}
                <p class="text-gray-500 italic">Aucun commentaire pour le moment.</p>
            {% endfor %}
        </div>

        {# üìù Formulaire de commentaire #}
        <div>
            <h4 class="text-xl font-semibold mb-4">Laisser un commentaire</h4>

            <div class="bg-gray-50 p-6 rounded-xl shadow-md">
                {{ form_start(commentForm) }}

                <div class="mb-4">
                    <label class="block mb-1 text-sm font-medium text-gray-700" for="author">Nom</label>
                    {{ form_widget(commentForm.author, {'attr': {'class': 'w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300'}}) }}
                </div>

                <div class="mb-4">
                    <label class="block mb-1 text-sm font-medium text-gray-700" for="content">Commentaire</label>
                    {{ form_widget(commentForm.content, {'attr': {'class': 'w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300'}}) }}
                </div>

                <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-md transition">
                    Envoyer
                </button>

                {{ form_end(commentForm) }}
            </div>
        </div>

    </div>
{% endblock %}
